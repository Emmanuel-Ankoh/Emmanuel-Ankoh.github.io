<%- include('../partials/head', { title }) %>
<main id="main" class="container">
  <h1>Profile</h1>
  <% if (error) { %><div class="alert error"><%= error %></div><% } %>
  <% if (success) { %><div class="alert success"><%= success %></div><% } %>
  <form method="POST" action="/admin/profile" class="contact-form" style="max-width:720px">
    <div class="grid" style="grid-template-columns:1fr 1fr;gap:1rem">
      <div>
        <label>Primary CTA Text</label>
        <input name="homeCtaPrimaryText" value="<%= settings && settings.homeCta && settings.homeCta.primaryText || '' %>" />
      </div>
      <div>
        <label>Primary CTA URL</label>
        <input name="homeCtaPrimaryUrl" value="<%= settings && settings.homeCta && settings.homeCta.primaryUrl || '' %>" />
      </div>
      <div>
        <label>Secondary CTA Text</label>
        <input name="homeCtaSecondaryText" value="<%= settings && settings.homeCta && settings.homeCta.secondaryText || '' %>" />
      </div>
      <div>
        <label>Secondary CTA URL</label>
        <input name="homeCtaSecondaryUrl" value="<%= settings && settings.homeCta && settings.homeCta.secondaryUrl || '' %>" />
      </div>
    </div>
    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
    <label>Name</label>
    <input name="name" value="<%= settings && settings.name || '' %>" required />
    <label>Headline</label>
    <input name="headline" value="<%= settings && settings.headline || '' %>" required />
    <label>Summary</label>
    <textarea name="summary" rows="5" required><%= settings && settings.summary || '' %></textarea>
    <label>Avatar URL</label>
    <input name="avatarUrl" value="<%= settings && settings.avatarUrl || '' %>" placeholder="https://..." />
    <label>Resume URL</label>
    <input name="resumeUrl" value="<%= settings && settings.resumeUrl || '' %>" />
    <label>Contact Intro</label>
    <input name="contactIntro" value="<%= settings && settings.contactIntro || '' %>" />
    <fieldset style="border:1px solid var(--border);padding:1rem;border-radius:.5rem">
      <legend>Social Links</legend>
      <div class="grid" style="grid-template-columns:1fr 1fr;gap:1rem">
        <div>
          <label>GitHub</label>
          <input name="socials.github" value="<%= settings && settings.socials && settings.socials.github || '' %>" />
        </div>
        <div>
          <label>LinkedIn</label>
          <input name="socials.linkedin" value="<%= settings && settings.socials && settings.socials.linkedin || '' %>" />
        </div>
        <div>
          <label>Twitter</label>
          <input name="socials.twitter" value="<%= settings && settings.socials && settings.socials.twitter || '' %>" />
        </div>
        <div>
          <label>Email</label>
          <input name="socials.email" value="<%= settings && settings.socials && settings.socials.email || '' %>" />
        </div>
      </div>
    </fieldset>

  <label>About Body</label>
  <div id="about-editor" style="min-height:180px;background:var(--card);border:1px solid var(--border);border-radius:.5rem"></div>
  <textarea name="aboutBody" rows="6" style="display:none"><%= settings && settings.aboutBody || '' %></textarea>
    <fieldset style="border:1px solid var(--border);padding:1rem;border-radius:.5rem;margin-top:1rem">
      <legend>Timeline</legend>
      <small>One item per line. Format: year | title | subtitle | description. You can also just write a description per line.</small>
      <textarea name="timelineText" rows="6"><%=(Array.isArray(settings && settings.timeline) ? (settings.timeline.map(function(it){
        var parts=[]; if (it.year) parts.push(it.year); if (it.title) parts.push(it.title); if (it.subtitle) parts.push(it.subtitle); if (it.description) parts.push(it.description);
        return parts.join(' | ');
      }).join('\n')) : '') %></textarea>
    </fieldset>

    <fieldset style="border:1px solid var(--border);padding:1rem;border-radius:.5rem;margin-top:1rem">
      <legend>Skills</legend>
      <small>One skill per line. Format: Name:Level (0-100). Example: JavaScript:90</small>
      <textarea name="skillsText" rows="6"><%=(Array.isArray(settings && settings.skills) ? (settings.skills.map(function(s){
        var lvl = (typeof s.level === 'number' ? s.level : '');
        return (s.name || '') + (lvl!=='' ? (':' + lvl) : '');
      }).join('\n')) : '') %></textarea>
    </fieldset>
    <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
    <script>
      (function(){
        const form = document.currentScript.closest('form');
        const aboutEditor = document.getElementById('about-editor');
        const aboutTextarea = form.querySelector('textarea[name="aboutBody"]');
        if (aboutEditor && window.Quill) {
          const quill = new Quill(aboutEditor, {
            theme: 'snow',
            modules: { toolbar: [['bold','italic','underline','strike'],[{header:[1,2,3,false]}],[{list:'ordered'},{list:'bullet'}],['blockquote','code-block'],['link'],['clean']] }
          });
          quill.root.innerHTML = aboutTextarea.value || '';
          form.addEventListener('submit', ()=>{ aboutTextarea.value = quill.root.innerHTML; });
        }
      })();
    </script>

    
    <div class="toolbar">
      <div></div>
      <button class="btn btn-primary" type="submit">Save</button>
    </div>
  </form>
</main>
<%- include('../partials/footer') %>
