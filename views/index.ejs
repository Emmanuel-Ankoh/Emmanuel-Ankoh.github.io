<%- include('partials/head', { title }) %>
<main id="main" class="home">
  <% const profileData = profile || {}; %>
  <% const settingsData = settings || profileData || {}; %>
  <% const homeCopy = settingsData.homeCopy || {}; %>
  <% const displayName = settingsData.name || profileData.name || 'Your Name'; %>
  <% const firstName = String(displayName).split(' ')[0]; %>
  <% const heroHeadline = settingsData.headline || profileData.headline || 'Full-Stack Developer'; %>
  <% const heroMission = settingsData.mission || profileData.mission || settingsData.summary || profileData.summary || 'I build fast, accessible, and delightful web apps with clean code and solid engineering practices.'; %>
  <% const heroSocials = settingsData.socials || profileData.socials || {}; %>
  <% const heroLocation = settingsData.location || profileData.location || ''; %>
  <% const heroPhone = settingsData.phone || profileData.phone || ''; %>
  <% const heroAvailability = (typeof settingsData.availability === 'boolean') ? settingsData.availability : (typeof profileData.availability === 'boolean' ? profileData.availability : null); %>
  <% const heroEmail = heroSocials.email || ''; %>
  <% const heroGreetingText = (homeCopy.heroGreeting || "Hi, I'm").trim() || "Hi, I'm"; %>
  <% const heroHighlightText = (homeCopy.heroHighlight || 'elegant digital experiences').trim() || 'elegant digital experiences'; %>
  <% const heroStatementRaw = (homeCopy.heroStatement || 'I craft elegant digital experiences that deliver measurable impact.').trim() || 'I craft elegant digital experiences that deliver measurable impact.'; %>
  <% const heroStatementParts = heroHighlightText ? heroStatementRaw.split(heroHighlightText) : [heroStatementRaw]; %>
  <% const heroStatementStart = heroStatementParts[0] || ''; %>
  <% const heroStatementEnd = heroStatementParts.length > 1 ? heroStatementParts.slice(1).join(heroHighlightText) : ''; %>
  <% const heroSecondaryTitle = (homeCopy.heroSecondaryTitle || 'Currently focused on').trim() || 'Currently focused on'; %>
  <% const heroSecondaryConfigured = Array.isArray(homeCopy.heroSecondaryItems) ? homeCopy.heroSecondaryItems.filter(item => item && (item.label || item.value)) : []; %>
  <% const primaryCtaText = (settingsData.homeCta && settingsData.homeCta.primaryText) || 'View Projects'; %>
  <% const primaryCtaUrl = (settingsData.homeCta && settingsData.homeCta.primaryUrl) || '/projects'; %>
  <% const secondaryCtaText = (settingsData.homeCta && settingsData.homeCta.secondaryText) || 'Book a discovery call'; %>
  <% const secondaryCtaUrl = (settingsData.homeCta && settingsData.homeCta.secondaryUrl) || '/contact'; %>
  <% const timeline = Array.isArray(profileData.timeline) ? profileData.timeline.filter(Boolean) : []; %>
  <% const testimonials = Array.isArray(profileData.testimonials) ? profileData.testimonials.filter(t => t && t.name && t.quote) : []; %>
  <% const notes = Array.isArray(profileData.notes) ? profileData.notes.filter(n => n && n.title && (n.summary || n.url)) : []; %>
  <% const skillGroups = Array.isArray(profileData.skillGroups) ? profileData.skillGroups.filter(g => g && Array.isArray(g.skills) && g.skills.length) : []; %>
  <% const baseSkills = Array.isArray(profileData.skills) ? profileData.skills.filter(Boolean) : []; %>
  <% const featuredProjects = Array.isArray(featured) ? featured : []; %>
  <% const yearMatches = timeline.map(item => { if (!item || !item.year) return null; const match = String(item.year).match(/\d{4}/); return match ? parseInt(match[0], 10) : null; }).filter(year => Number.isFinite(year)); %>
  <% const experienceYears = yearMatches.length ? Math.max(1, new Date().getFullYear() - Math.min.apply(null, yearMatches)) : null; %>
  <% const heroStatsRaw = [
    experienceYears ? { label: 'Years of impact', value: experienceYears + '+' } : null,
    featuredProjects.length ? { label: 'Signature builds', value: featuredProjects.length } : null,
    testimonials.length ? { label: 'Client endorsements', value: testimonials.length } : null,
    notes.length ? { label: 'Knowledge notes', value: notes.length } : null
  ].filter(Boolean); %>
  <% const heroSecondaryFallback = [
    heroHeadline ? { label: 'Craft', value: heroHeadline } : null,
    heroAvailability !== null ? { label: 'Status', value: heroAvailability ? 'Open for collaborations' : 'Heads down on client work' } : null,
    heroLocation ? { label: 'Location', value: heroLocation } : null,
    experienceYears ? { label: 'Experience', value: experienceYears + '+ years' } : null
  ].filter(Boolean); %>
  <% const heroSecondaryItems = heroSecondaryConfigured.length ? heroSecondaryConfigured : heroSecondaryFallback; %>
  <% const capabilitiesHeading = (homeCopy.capabilitiesHeading || 'What I bring to every engagement').trim() || 'What I bring to every engagement'; %>
  <% const capabilitiesLead = (homeCopy.capabilitiesLead || 'Human-centered thinking, meticulous execution, and a collaborative spirit that keeps projects moving swiftly from concept to launch.').trim(); %>
  <% const experienceHeading = (homeCopy.experienceHeading || 'Strategic engineering, thoughtful design').trim() || 'Strategic engineering, thoughtful design'; %>
  <% const experienceLead = (homeCopy.experienceLead || 'I help product teams transform ambitious ideas into polished products, combining robust architecture with moments of delight that users remember.').trim(); %>
  <% const timelineHeading = (homeCopy.timelineHeading || 'Recent milestones').trim() || 'Recent milestones'; %>
  <% const timelineLead = (homeCopy.timelineLead || '').trim(); %>
  <% const skillsHeading = (homeCopy.skillsHeading || 'Toolkit').trim() || 'Toolkit'; %>
  <% const skillsLead = (homeCopy.skillsLead || '').trim(); %>
  <% const featureHeading = (homeCopy.featureHeading || 'Selected work that blends craft and conversion').trim() || 'Selected work that blends craft and conversion'; %>
  <% const featureLead = (homeCopy.featureLead || 'Each project pairs elegant UI with resilient engineering to launch faster and perform longer.').trim(); %>
  <% const testimonialsHeading = (homeCopy.testimonialsHeading || 'Trusted by collaborators & clients').trim() || 'Trusted by collaborators & clients'; %>
  <% const testimonialsLead = (homeCopy.testimonialsLead || 'Relationships thrive on clarity, reliability, and consistent delivery - that\'s the foundation of every engagement.').trim(); %>
  <% const notesHeading = (homeCopy.notesHeading || 'Latest thinking from the notebook').trim() || 'Latest thinking from the notebook'; %>
  <% const notesLead = (homeCopy.notesLead || 'Short notes, deep dives, and resources that explore the craft of building modern products.').trim(); %>
  <% const closingHeading = (homeCopy.closingHeading || 'Let\'s build the next standout experience').trim() || 'Let\'s build the next standout experience'; %>
  <% const closingLead = (homeCopy.closingLead || settingsData.contactIntro || profileData.contactIntro || 'Feel free to reach out for collaborations or just a friendly hello.').trim(); %>
  <% const closingPrimaryText = (homeCopy.closingPrimaryText || primaryCtaText || 'Start a project').trim() || 'Start a project'; %>
  <% const closingPrimaryUrl = (homeCopy.closingPrimaryUrl || primaryCtaUrl || '/contact').trim() || '/contact'; %>
  <% const closingSecondaryText = (homeCopy.closingSecondaryText || secondaryCtaText || (heroEmail ? 'Email directly' : 'Get in touch')).trim(); %>
  <% const closingSecondaryUrlRaw = (homeCopy.closingSecondaryUrl || '').trim(); %>
  <% const closingSecondaryUrl = closingSecondaryUrlRaw || (heroEmail ? 'mailto:' + heroEmail : secondaryCtaUrl || '/contact'); %>

  <section class="home-hero" aria-label="Intro">
    <div class="container home-hero__layout">
      <div class="home-hero__primary" data-aos="fade-up">
        <span class="home-hero__pill"><%= heroHeadline %></span>
        <h1 class="home-hero__title">
          <span class="home-hero__greeting"><%= heroGreetingText %> <%= firstName %>.</span>
          <% if (heroStatementParts.length > 1) { %>
            <span><%= heroStatementStart %><em class="home-hero__highlight"><%= heroHighlightText %></em><%= heroStatementEnd %></span>
          <% } else { %>
            <span><%= heroStatementRaw %></span>
          <% } %>
        </h1>
        <p class="home-hero__lede"><%= heroMission %></p>
        <div class="home-hero__ctas">
          <a href="<%= primaryCtaUrl %>" class="btn btn-primary"><%= primaryCtaText %></a>
          <a href="<%= secondaryCtaUrl %>" class="btn btn-ghost"><span><%= secondaryCtaText %></span></a>
          <% if (settingsData.resumeUrl || profileData.resumeUrl) { %>
            <a href="<%= settingsData.resumeUrl || profileData.resumeUrl %>" class="btn btn-soft" target="_blank" rel="noopener">Download résumé</a>
          <% } %>
        </div>

        <% if (heroSocials && Object.keys(heroSocials).length) { %>
          <ul class="home-hero__socials" data-aos="fade-up" data-aos-delay="150">
            <% if (heroSocials.github) { %><li><a href="<%= heroSocials.github %>" target="_blank" rel="noopener">GitHub</a></li><% } %>
            <% if (heroSocials.linkedin) { %><li><a href="<%= heroSocials.linkedin %>" target="_blank" rel="noopener">LinkedIn</a></li><% } %>
            <% if (heroSocials.twitter) { %><li><a href="<%= heroSocials.twitter %>" target="_blank" rel="noopener">Twitter</a></li><% } %>
            <% if (heroSocials.instagram) { %><li><a href="<%= heroSocials.instagram %>" target="_blank" rel="noopener">Instagram</a></li><% } %>
            <% if (heroSocials.youtube) { %><li><a href="<%= heroSocials.youtube %>" target="_blank" rel="noopener">YouTube</a></li><% } %>
            <% if (heroSocials.stackoverflow) { %><li><a href="<%= heroSocials.stackoverflow %>" target="_blank" rel="noopener">Stack Overflow</a></li><% } %>
            <% if (heroEmail) { %><li><a href="mailto:<%= heroEmail %>">Email</a></li><% } %>
          </ul>
        <% } %>

        <% if (heroLocation || heroPhone || heroEmail || heroAvailability !== null) { %>
          <ul class="home-hero__meta">
            <% if (heroLocation) { %><li><i class="home-hero__icon">📍</i><span><%= heroLocation %></span></li><% } %>
            <% if (heroEmail) { %><li><i class="home-hero__icon">✉️</i><span><a href="mailto:<%= heroEmail %>"><%= heroEmail %></a></span></li><% } %>
            <% if (heroPhone) { %><li><i class="home-hero__icon">☎️</i><span><a href="tel:<%= heroPhone %>"><%= heroPhone %></a></span></li><% } %>
            <% if (heroAvailability !== null) { %><li><i class="home-hero__icon">🗓</i><span><span class="badge badge-availability <%= heroAvailability ? 'badge-availability--open' : 'badge-availability--closed' %>"><%= heroAvailability ? 'Accepting new work' : 'Currently booked' %></span></span></li><% } %>
          </ul>
        <% } %>

        <% if (heroStatsRaw.length) { %>
          <ul class="home-hero__stats" data-aos="fade-up" data-aos-delay="200">
            <% heroStatsRaw.forEach((stat) => { %>
              <li class="home-hero__stat" aria-label="<%= stat.label %>">
                <strong><%= stat.value %></strong>
                <span><%= stat.label %></span>
              </li>
            <% }) %>
          </ul>
        <% } %>
      </div>

      <div class="home-hero__secondary" data-aos="fade-left" data-aos-delay="150">
        <figure class="home-hero__portrait">
          <div class="home-hero__portrait-glow"></div>
          <img src="<%= settingsData.avatarUrl || profileData.avatarUrl || '/images/placeholder.svg' %>" alt="Portrait of <%= displayName %>" loading="lazy" decoding="async">
        </figure>
        <div class="home-hero__card">
          <h3><%= heroSecondaryTitle %></h3>
          <ul>
            <% let heroSecondaryRendered = false; %>
            <% heroSecondaryItems.forEach(item => { const label = (item.label || '').trim(); const value = (item.value || '').trim(); if (!label && !value) { return; } heroSecondaryRendered = true; %>
              <li>
                <% if (label) { %><span><%= label %></span><% } %>
                <% if (value) { %><strong><%= value %></strong><% } %>
              </li>
            <% }); if (!heroSecondaryRendered) { %>
              <li><span>Craft</span><strong><%= heroHeadline %></strong></li>
            <% } %>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <section class="capabilities" aria-labelledby="capabilities-heading">
    <div class="container">
      <div class="section-heading" data-aos="fade-up">
        <span class="section-eyebrow">Core strengths</span>
        <h2 id="capabilities-heading"><%= capabilitiesHeading %></h2>
        <% if (capabilitiesLead) { %><p><%= capabilitiesLead %></p><% } %>
      </div>
      <% if (skillGroups.length) { %>
        <div class="capabilities__grid">
          <% skillGroups.slice(0,3).forEach((group, idx) => { const skillsSubset = (group.skills || []).slice(0,5); %>
            <article class="capability-card" data-aos="fade-up" data-aos-delay="<%= idx * 80 %>">
              <span class="capability-card__badge">Area <%= idx + 1 %></span>
              <h3><%= group.title || 'Capabilities' %></h3>
              <% if (skillsSubset.length) { %>
                <ul>
                  <% skillsSubset.forEach(skill => { %>
                    <li><%= skill.name %></li>
                  <% }) %>
                </ul>
              <% } %>
              <a class="capability-card__cta" href="/skills">Explore practice</a>
            </article>
          <% }) %>
        </div>
      <% } else if (baseSkills.length) { %>
        <div class="capabilities__grid">
          <article class="capability-card" data-aos="fade-up">
            <span class="capability-card__badge">Focus</span>
            <h3>Technical toolset</h3>
            <ul>
              <% baseSkills.slice(0,8).forEach(skill => { %>
                <li><%= skill.name %></li>
              <% }) %>
            </ul>
            <a class="capability-card__cta" href="/skills">See full stack</a>
          </article>
          <article class="capability-card" data-aos="fade-up" data-aos-delay="80">
            <span class="capability-card__badge">Approach</span>
            <h3>Product craftsmanship</h3>
            <p>I partner closely with product teams to translate ideas into resilient systems, focusing on maintainability, accessibility, and performance.</p>
          </article>
          <article class="capability-card" data-aos="fade-up" data-aos-delay="160">
            <span class="capability-card__badge">Mindset</span>
            <h3>Collaborative leadership</h3>
            <p>From discovery workshops to production roll-outs, I communicate clearly, plan pragmatically, and keep stakeholders aligned without losing momentum.</p>
          </article>
        </div>
      <% } else { %>
        <p class="capabilities__empty">Add skill groups in Admin → Profile to showcase your expertise here.</p>
      <% } %>
    </div>
  </section>

  <section class="experience-suite" aria-labelledby="experience-heading">
    <div class="container experience-suite__grid">
      <article class="experience-card" data-aos="fade-up">
        <span class="section-eyebrow">About</span>
        <h2 id="experience-heading"><%= experienceHeading %></h2>
        <% if (profileData.aboutBody) { %>
          <div class="experience-card__body"><%- profileData.aboutBody %></div>
        <% } else if (experienceLead) { %>
          <p class="experience-card__body"><%= experienceLead %></p>
        <% } %>
        <a class="experience-card__cta" href="/about">Meet the person behind the work</a>
      </article>

      <article class="experience-card experience-card--timeline" data-aos="fade-up" data-aos-delay="100">
        <span class="section-eyebrow"><%= timelineHeading %></span>
        <% if (timelineLead) { %><p class="experience-card__body"><%= timelineLead %></p><% } %>
        <% if (timeline.length) { %>
          <ol class="experience-timeline">
            <% timeline.slice(0,3).forEach((item) => { %>
              <li>
                <div>
                  <h3><%= item.title || item.year || 'Experience' %></h3>
                  <p class="experience-timeline__meta">
                    <%= item.subtitle || '' %>
                    <%= (item.subtitle && item.year) ? ' · ' : '' %>
                    <%= item.year || '' %>
                  </p>
                  <% if (item.description) { %>
                    <p class="experience-timeline__copy"><%= item.description %></p>
                  <% } %>
                </div>
              </li>
            <% }) %>
          </ol>
          <a class="experience-card__cta" href="/about">Review full journey</a>
        <% } else { %>
          <p class="experience-card__body">Timeline entries will appear once you add them in Admin → Profile.</p>
        <% } %>
      </article>

      <article class="experience-card experience-card--skills" data-aos="fade-up" data-aos-delay="180">
        <span class="section-eyebrow"><%= skillsHeading %></span>
        <% if (skillsLead) { %><p class="experience-card__body"><%= skillsLead %></p><% } %>
        <% if (skillGroups.length) { %>
          <div class="skill-palette">
            <% skillGroups.slice(0,2).forEach(group => { const subset = (group.skills || []).slice(0,4); %>
              <div class="skill-palette__column">
                <h3><%= group.title || 'Skills' %></h3>
                <ul>
                  <% subset.forEach(skill => { %>
                    <li><%= skill.name %></li>
                  <% }) %>
                </ul>
              </div>
            <% }) %>
          </div>
        <% } else if (baseSkills.length) { %>
          <div class="skill-palette">
            <div class="skill-palette__column">
              <h3>Key technologies</h3>
              <ul>
                <% baseSkills.slice(0,6).forEach(skill => { %>
                  <li><%= skill.name %></li>
                <% }) %>
              </ul>
            </div>
          </div>
        <% } else { %>
          <p class="experience-card__body">Add skills to spotlight your favourite tools and frameworks.</p>
        <% } %>
        <a class="experience-card__cta" href="/skills">See complete capabilities</a>
      </article>
    </div>
  </section>

  <section class="feature-showcase" aria-labelledby="feature-showcase-heading">
    <div class="container">
      <div class="section-heading" data-aos="fade-up">
        <span class="section-eyebrow">Case studies</span>
        <h2 id="feature-showcase-heading"><%= featureHeading %></h2>
        <% if (featureLead) { %><p><%= featureLead %></p><% } %>
      </div>
      <% if (featuredProjects.length) { %>
        <div class="case-study-grid">
          <% featuredProjects.forEach((p, i) => { %>
            <article class="case-study-card" data-aos="fade-up" data-aos-delay="<%= i * 70 %>">
              <figure class="case-study-card__media">
                <img src="<%= p.imageUrl || '/images/placeholder.svg' %>" alt="Screenshot of <%= p.title %>"
                  loading="lazy" decoding="async"
                  <% if (p.imageUrl && clSrcset(p.imageUrl)) { %>
                    srcset="<%= clSrcset(p.imageUrl) %>" sizes="<%= clSizesDefault %>"
                  <% } %>
                >
                <span class="case-study-card__badge">Featured</span>
              </figure>
              <div class="case-study-card__body">
                <header>
                  <h3><%= p.title %></h3>
                  <% if (p.year) { %><span class="case-study-card__meta"><%= p.year %></span><% } %>
                </header>
                <p><%= p.description %></p>
                <% if (Array.isArray(p.tech) && p.tech.length) { %>
                  <ul class="case-study-card__tags">
                    <% p.tech.slice(0,6).forEach(tag => { %>
                      <li><%= tag %></li>
                    <% }) %>
                  </ul>
                <% } %>
                <div class="case-study-card__actions">
                  <% if (p.githubUrl) { %><a class="btn btn-ghost" href="<%= p.githubUrl %>" target="_blank" rel="noopener">View code</a><% } %>
                  <% if (p.demoUrl) { %><a class="btn btn-primary" href="<%= p.demoUrl %>" target="_blank" rel="noopener">Launch project</a><% } %>
                </div>
              </div>
            </article>
          <% }) %>
        </div>
        <div class="section-footer" data-aos="fade-up" data-aos-delay="100">
          <a class="btn btn-soft" href="/projects">Explore the full portfolio</a>
        </div>
      <% } else { %>
        <div class="case-study-empty" data-aos="fade-up">
          <h3>No featured projects yet</h3>
          <p>Showcase a few recent wins by marking projects as featured in the admin dashboard.</p>
          <a class="btn btn-primary" href="/projects">Browse all projects</a>
        </div>
      <% } %>
    </div>
  </section>

  <section class="acclaim" aria-labelledby="acclaim-heading">
    <div class="container">
      <div class="section-heading" data-aos="fade-up">
        <span class="section-eyebrow">Testimonials</span>
        <h2 id="acclaim-heading"><%= testimonialsHeading %></h2>
        <% if (testimonialsLead) { %><p><%= testimonialsLead %></p><% } %>
      </div>
      <% if (testimonials.length) { %>
        <div class="acclaim__grid">
          <% testimonials.slice(0,6).forEach((t, idx) => { %>
            <article class="acclaim-card" data-aos="fade-up" data-aos-delay="<%= idx * 70 %>">
              <% if (t.avatarUrl) { %>
                <img class="acclaim-card__avatar" src="<%= t.avatarUrl %>" alt="Portrait of <%= t.name %>" loading="lazy" decoding="async">
              <% } %>
              <blockquote>“<%= t.quote %>”</blockquote>
              <footer>
                <div>
                  <strong><%= t.name %></strong>
                  <% if (t.role) { %><span> · <%= t.role %></span><% } %>
                </div>
                <% if (t.link) { %>
                  <a href="<%= t.link %>" target="_blank" rel="noopener">Read more</a>
                <% } %>
              </footer>
            </article>
          <% }) %>
        </div>
      <% } else { %>
        <p class="acclaim__empty">Add testimonials in Admin → Profile to build social proof here.</p>
      <% } %>
    </div>
  </section>

  <section class="knowledge-hub" aria-labelledby="knowledge-heading">
    <div class="container">
      <div class="section-heading" data-aos="fade-up">
        <span class="section-eyebrow">Insights</span>
        <h2 id="knowledge-heading"><%= notesHeading %></h2>
        <% if (notesLead) { %><p><%= notesLead %></p><% } %>
      </div>
      <% if (notes.length) { %>
        <div class="knowledge-hub__grid">
          <% notes.slice(0,4).forEach((entry, idx) => { %>
            <article class="knowledge-card" data-aos="fade-up" data-aos-delay="<%= idx * 70 %>">
              <header>
                <h3><%= entry.title %></h3>
                <% if (entry.date) { %><span class="knowledge-card__date"><%= entry.date %></span><% } %>
              </header>
              <% if (entry.summary) { %><p><%= entry.summary %></p><% } %>
              <div class="knowledge-card__actions">
                <% if (entry.url) { %>
                  <a class="btn btn-ghost" href="<%= entry.url %>" target="_blank" rel="noopener">Read article</a>
                <% } else { %>
                  <a class="btn btn-soft" href="/notes">View details</a>
                <% } %>
              </div>
            </article>
          <% }) %>
        </div>
        <% if (notes.length > 4) { %>
          <div class="section-footer" data-aos="fade-up" data-aos-delay="100">
            <a class="btn btn-primary" href="/notes">Browse all writing</a>
          </div>
        <% } %>
      <% } else { %>
        <p class="knowledge-hub__empty">Use Admin → Profile to add recent talks, articles, or resources.</p>
      <% } %>
    </div>
  </section>

  <section class="closing-cta" aria-labelledby="closing-cta-heading">
    <div class="container">
      <div class="closing-cta__content" data-aos="fade-up">
        <span class="section-eyebrow">Collaborate</span>
        <h2 id="closing-cta-heading"><%= closingHeading %></h2>
        <% if (closingLead) { %><p><%= closingLead %></p><% } %>
        <div class="closing-cta__actions">
          <a class="btn btn-primary" href="<%= closingPrimaryUrl %>"><%= closingPrimaryText %></a>
          <% if (closingSecondaryText) { %>
            <a class="btn btn-ghost" href="<%= closingSecondaryUrl %>"><%= closingSecondaryText %></a>
          <% } %>
        </div>
      </div>
    </div>
  </section>
</main>
<%- include('partials/footer') %>
