<%- include('partials/head', { title }) %>
<main id="main" class="container">
  <h1>Projects</h1>
  <form method="GET" action="/projects" style="margin:.5rem 0 1rem;display:flex;gap:.5rem;flex-wrap:wrap">
    <input name="q" value="<%= typeof q !== 'undefined' ? q : '' %>" placeholder="Search by title, tech, description..." style="flex:1;min-width:220px"/>
    <select name="tech" aria-label="Filter by technology">
      <option value="">All Tech</option>
      <% (techs || []).forEach(t => { %>
        <option value="<%= t %>" <%= tech === t ? 'selected' : '' %>><%= t %></option>
      <% }) %>
    </select>
    <button class="btn" type="submit">Apply</button>
  </form>
  <div class="grid">
    <% if ((projects || []).length === 0) { %>
      <p>No projects yet. Admin can add some!</p>
    <% } %>
    <% (projects || []).forEach((p, i) => { %>
      <article class="card" data-aos="fade-up" data-aos-delay="<%= i * 40 %>">
        <img src="<%= p.imageUrl || '/images/placeholder.svg' %>" alt="Screenshot of <%= p.title %>" loading="lazy" decoding="async"
             <% if (p.imageUrl && clSrcset(p.imageUrl)) { %>
               srcset="<%= clSrcset(p.imageUrl) %>" sizes="<%= clSizesDefault %>"
             <% } %>
        />
        <div class="card-body">
          <h3><a href="/projects/<%= p.slug %>"><%= p.title %></a></h3>
          <p><%= p.description %></p>
          <div class="tags">
            <% (p.tech || []).forEach(t => { %>
              <span class="tag"><%= t %></span>
            <% }) %>
          </div>
          <div class="actions">
            <% if (p.githubUrl) { %><a class="btn" href="<%= p.githubUrl %>" target="_blank" rel="noopener">Code</a><% } %>
            <% if (p.demoUrl) { %><a class="btn btn-primary" href="<%= p.demoUrl %>" target="_blank" rel="noopener">Live</a><% } %>
          </div>
        </div>
      </article>
    <% }) %>
  </div>
  <% if (typeof page !== 'undefined' && typeof pages !== 'undefined' && pages > 1) { %>
    <div style="margin-top:1rem;display:flex;gap:.5rem;flex-wrap:wrap">
      <% for (let i=1;i<=pages;i++){ %>
        <a class="btn" href="/projects?<%= 'page=' + i + (q ? ('&q=' + encodeURIComponent(q)) : '') + (tech ? ('&tech=' + encodeURIComponent(tech)) : '') %>"><%= i === page ? ('['+i+']') : i %></a>
      <% } %>
    </div>
  <% } %>
</main>
<%- include('partials/footer') %>
